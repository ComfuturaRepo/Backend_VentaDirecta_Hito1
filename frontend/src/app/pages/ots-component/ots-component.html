<div class="ots-container">
  <!-- Header limpio -->
  <div class="ots-header">
    <div class="container-fluid">
      <div class="row align-items-center mb-4">
        <div class="col-md-6">
          <div class="page-title-section">
            <div class="d-flex align-items-center">
              <div class="title-icon me-3">
                <i class="bi bi-clipboard-check"></i>
              </div>
              <div>
                <h1 class="page-title">Órdenes de Trabajo</h1>
                <p class="page-subtitle">Gestión completa de OTs del sistema</p>
                <div class="d-flex align-items-center gap-3 mt-2">
                  <span class="badge bg-gray-100 text-gray-700 border">
                    <i class="bi bi-clock me-1"></i>Última actualización: {{lastUpdate | date:'HH:mm'}}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <div class="d-flex justify-content-end align-items-center gap-2">
            <!-- Botón de refrescar -->
            <button class="btn btn-outline-gray btn-lg"
                    (click)="refreshTable()"
                    [disabled]="loading"
                    [title]="'Refrescar tabla'">
              <i class="bi bi-arrow-clockwise" [class.spin]="loading"></i>
              <span class="d-none d-md-inline ms-2">Refrescar</span>
            </button>

            <!-- Exportación dropdown -->
            <div class="dropdown" ngbDropdown>
              <button class="btn btn-outline-gray btn-lg" ngbDropdownToggle>
                <i class="bi bi-download me-2"></i>Exportar
              </button>
              <div class="dropdown-menu dropdown-menu-end shadow" ngbDropdownMenu>
                <div class="dropdown-header">
                  <i class="bi bi-file-earmark-excel me-2 text-blue"></i>
                  <span class="fw-bold">Exportar a Excel</span>
                </div>

                <button class="dropdown-item d-flex align-items-center justify-content-between py-2"
                        (click)="exportSelectedOts()"
                        [disabled]="selectedCount === 0">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-check-circle me-2 text-green"></i>
                    <span>Seleccionadas</span>
                  </div>
                  <span *ngIf="selectedCount > 0" class="badge bg-blue text-white rounded-pill">
                    {{selectedCount}}
                  </span>
                </button>

                <button class="dropdown-item d-flex align-items-center justify-content-between py-2"
                        (click)="exportAllOts()">
                  <div class="d-flex align-items-center">
                    <i class="bi bi-database me-2 text-cyan"></i>
                    <span>Todas las OTs</span>
                  </div>
                  <span class="badge bg-cyan text-white rounded-pill">
                    {{totalElements}}
                  </span>
                </button>

                <button class="dropdown-item d-flex align-items-center py-2"
                        (click)="openExportModal()">
                  <i class="bi bi-sliders me-2 text-orange"></i>
                  <span>Exportación Avanzada</span>
                </button>

                <div class="dropdown-divider"></div>

                <div class="dropdown-header">
                  <i class="bi bi-file-earmark-arrow-down me-2 text-green"></i>
                  <span class="fw-bold">Plantillas</span>
                </div>

                <button class="dropdown-item d-flex align-items-center py-2"
                        (click)="downloadImportTemplate()">
                  <i class="bi bi-file-earmark-spreadsheet me-2 text-green"></i>
                  <span>Plantilla de Importación</span>
                </button>
              </div>
            </div>

            <!-- Botón de importación -->
            <button class="btn btn-outline-gray btn-lg" (click)="openImportModal()">
              <i class="bi bi-upload me-2"></i>Importar
            </button>

            <!-- Botón de nueva OT -->
            <button class="btn btn-primary btn-lg" (click)="openCreateModal()">
              <i class="bi bi-plus-lg me-2"></i>Nueva OT
            </button>
          </div>
        </div>
      </div>

      <!-- Filtros con diseño simple -->
      <div class="row">
        <div class="col-12">
          <div class="filters-card">
            <div class="row g-3 align-items-end">
              <!-- Búsqueda -->
              <div class="col-lg-6 col-xl-6">
                <label class="form-label text-gray-700 fw-medium mb-2">
                  <i class="bi bi-search me-1"></i>Búsqueda
                </label>
                <div class="input-group input-group-lg search-box">
                  <span class="input-group-text bg-white border-end-0">
                    <i class="bi bi-search text-gray-600"></i>
                  </span>
                  <input type="text" class="form-control border-start-0"
                         [(ngModel)]="searchText"
                         (keyup.enter)="onSearch()"
                         placeholder="Buscar por OT, descripción, cliente...">
                  <button class="btn btn-outline-gray" type="button" (click)="onSearch()">
                    Buscar
                  </button>
                  <button class="btn btn-outline-gray" type="button" (click)="clearFilters()"
                          title="Limpiar filtros">
                    <i class="bi bi-x-circle"></i>
                  </button>
                </div>
              </div>

              <!-- Filtro de estado -->
              <div class="col-lg-3 col-xl-3">
                <label class="form-label text-gray-700 fw-medium mb-2">
                  <i class="bi bi-filter-circle me-1"></i>Estado
                </label>
                <select class="form-select form-select-lg" [(ngModel)]="estadoFilter" (change)="onSearch()">
                  <option *ngFor="let estado of estados" [value]="estado.value">
                    <i [class]="estado.icon + ' me-2'"></i>{{estado.label}}
                  </option>
                </select>
              </div>

              <!-- Mostrar -->
              <div class="col-lg-3 col-xl-3">
                <div class="d-flex align-items-center justify-content-end h-100 gap-3">
                  <div class="show-select">
                    <label class="form-label text-gray-700 fw-medium mb-2 d-block">
                      <i class="bi bi-list-ul me-1"></i>Mostrar
                    </label>
                    <select class="form-select form-select-lg" [(ngModel)]="pageSize" (change)="changePageSize(pageSize)">
                      <option [value]="10">10 registros</option>
                      <option [value]="20">20 registros</option>
                      <option [value]="50">50 registros</option>
                      <option [value]="100">100 registros</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="container-fluid py-4">
    <!-- Mensajes de estado -->
    <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
      <div class="d-flex align-items-center">
        <i class="bi bi-exclamation-triangle-fill me-3 fs-4"></i>
        <div class="flex-grow-1">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <strong class="d-block mb-1">Error al cargar datos</strong>
              <span class="d-block">{{errorMessage}}</span>
            </div>
            <button type="button" class="btn-close ms-3" (click)="errorMessage = ''"></button>
          </div>
        </div>
      </div>
    </div>

    <!-- Contador de seleccionadas -->
    <div *ngIf="selectedCount > 0" class="alert alert-info alert-dismissible fade show mb-4" role="alert">
      <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
          <div class="selection-count me-3">
            <i class="bi bi-check2-circle fs-3 text-blue"></i>
          </div>
          <div>
            <h6 class="mb-0 text-gray-800 fw-bold">{{selectedCount}} OT{{selectedCount > 1 ? 's' : ''}} seleccionada{{selectedCount > 1 ? 's' : ''}}</h6>
            <small class="text-gray-600">Listas para exportar o procesar</small>
          </div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-sm btn-primary" (click)="exportSelectedOts()">
            <i class="bi bi-download me-1"></i>Exportar
          </button>
          <button class="btn btn-sm btn-outline-gray"
                  (click)="selectedOts.clear(); selectedCount = 0; selectAllChecked = false;">
            <i class="bi bi-x-circle me-1"></i>Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Resumen de estadísticas -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon stat-icon-blue">
              <i class="bi bi-clipboard-data"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{totalElements}}</h3>
              <p class="stat-label">Total OTs</p>
              <small class="stat-change text-green">
                <i class="bi bi-arrow-up"></i> +12% este mes
              </small>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-icon-green">
              <i class="bi bi-check-circle"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{ activosCount }}</h3>
              <p class="stat-label">Activas</p>
              <small class="stat-change text-gray">
                {{ (activosCount / totalElements * 100) | number:'1.0-0' }}% del total
              </small>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-icon-orange">
              <i class="bi bi-clock-history"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{selectedCount}}</h3>
              <p class="stat-label">Seleccionadas</p>
              <small class="stat-change" [class.text-blue]="selectedCount > 0">
                <i *ngIf="selectedCount > 0" class="bi bi-check"></i>
                {{selectedCount > 0 ? 'Listas para acción' : 'Ninguna seleccionada'}}
              </small>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon stat-icon-cyan">
              <i class="bi bi-calendar-week"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-value">{{pendientesCount}}</h3>
              <p class="stat-label">Pendientes</p>
              <small class="stat-change text-orange">
                <i class="bi bi-clock"></i> Por atender
              </small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla principal -->
    <div class="card shadow-sm border-0 main-table-card">
      <div class="card-header bg-white border-bottom py-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-0 text-gray-800 fw-bold">
              <i class="bi bi-table me-2 text-blue"></i>
              Lista de Órdenes de Trabajo
            </h5>
            <small class="text-gray-600">Visualizando {{ots.length}} de {{totalElements}} registros</small>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button class="btn btn-sm btn-outline-gray" (click)="toggleColumnVisibility()">
              <i class="bi bi-columns-gap"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th class="border-0 ps-4" style="width: 40px;">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox"
                           [checked]="selectAllChecked"
                           (change)="toggleSelectAll($event)"
                           [indeterminate]="selectedCount > 0 && selectedCount < ots.length">
                  </div>
                </th>
                <th class="border-0 text-gray-700">OT</th>
                <th class="border-0 text-gray-700">Proyecto</th>
                <th class="border-0 text-gray-700">Cliente</th>
                <th class="border-0 text-gray-700">Estado</th>
                <th class="border-0 text-gray-700">Site</th>
                <th class="border-0 text-gray-700">Fecha Apertura</th>
                <th class="border-0 text-end pe-4 text-gray-700">Acciones</th>
              </tr>
            </thead>
            <tbody>
              <!-- Loading state -->
              <tr *ngIf="loading">
                <td colspan="8" class="text-center py-5">
                  <div class="d-flex flex-column align-items-center">
                    <div class="spinner-border text-blue spinner-lg" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p class="mt-3 text-gray-600 fw-medium">Cargando órdenes de trabajo...</p>
                  </div>
                </td>
              </tr>

              <!-- No results -->
              <tr *ngIf="!loading && ots.length === 0">
                <td colspan="8" class="text-center py-5">
                  <div class="empty-state">
                    <div class="empty-icon mb-4">
                      <i class="bi bi-inboxes display-1 text-gray-300"></i>
                    </div>
                    <h4 class="text-gray-500 fw-bold mb-3">No se encontraron OTs</h4>
                    <p class="text-gray-500 mb-4">Intenta ajustar los filtros o crear una nueva OT.</p>
                    <div class="d-flex gap-2 justify-content-center">
                      <button class="btn btn-outline-gray" (click)="clearFilters()">
                        <i class="bi bi-filter me-2"></i>Limpiar filtros
                      </button>
                      <button class="btn btn-primary" (click)="openCreateModal()">
                        <i class="bi bi-plus-lg me-2"></i>Crear nueva OT
                      </button>
                    </div>
                  </div>
                </td>
              </tr>

              <!-- OTs list -->
              <tr *ngFor="let ot of ots"
                  [class.table-active]="selectedOts.has(ot.idOts!)">
                <td class="ps-4">
                  <div class="form-check">
                    <input class="form-check-input" type="checkbox"
                           [checked]="selectedOts.has(ot.idOts!)"
                           (change)="toggleSelectOt(ot)">
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="ot-number">
                      <span class="badge bg-blue text-white rounded-pill px-3 py-2 fw-bold">
                        #{{ot.ot}}
                      </span>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="d-flex flex-column">
                    <span class="fw-semibold text-gray-800" [title]="ot.proyecto">
                      {{truncateText(ot.proyecto, 60) || 'Sin descripción'}}
                    </span>
                    <small class="text-gray-600">
                      <i class="bi bi-tag me-1"></i>{{ot.region || 'Sin región'}}
                    </small>
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="customer-avatar me-3">
                      <div class="avatar-circle bg-gray-100 text-gray-700">
                        {{ot.cliente?.charAt(0)?.toUpperCase() || 'C'}}
                      </div>
                    </div>
                    <div class="customer-info">
                      <div class="fw-semibold text-gray-800" [title]="ot.cliente">
                        {{truncateText(ot.cliente, 40) || 'Sin cliente'}}
                      </div>
                      <small class="text-gray-600">
                        <i class="bi bi-building me-1"></i>{{ot.cliente_id || 'Sin site'}}
                      </small>
                    </div>
                  </div>
                </td>
                <td>
                  <div class="d-flex flex-column">
                    <span class="badge estado-badge" [ngClass]="getEstadoClass(ot.estadoOt)">
                      <i class="bi me-1" [ngClass]="getEstadoIcon(ot.estadoOt)"></i>
                      {{ot.estadoOt || 'SIN ESTADO'}}
                    </span>
                    <small class="text-gray-600 mt-1">
                      <i class="bi bi-person me-1"></i>{{ot.cliente}}
                    </small>
                  </div>
                </td>
                <td>
                  <div class="d-flex flex-column">
                    <span class="fw-medium text-gray-800" [title]="ot.siteNombre">
                      {{ truncateText(ot.siteNombre, 30) || '—' }}
                    </span>
                    <small class="text-gray-600">
                      <i class="bi bi-geo-alt me-1"></i>{{ ot.site_descripcion || 'Sin site' }}
                    </small>
                  </div>
                </td>
                <td>
                  <div class="d-flex flex-column">
                    <span class="fw-medium text-gray-800">{{ot.fechaApertura | date:'dd/MM/yyyy'}}</span>
                    <small class="text-gray-600">
                      <i class="bi bi-clock me-1"></i>{{ot.fechaApertura | date:'HH:mm'}}
                    </small>
                  </div>
                </td>
                <td class="pe-4">
                  <div class="action-buttons">
                    <button class="btn btn-action btn-sm me-1"
                            (click)="openViewModal(ot)"
                            title="Ver detalle"
                            data-bs-toggle="tooltip">
                      <i class="bi bi-eye"></i>
                    </button>
                    <button class="btn btn-action btn-sm me-1"
                            (click)="openEditModal(ot)"
                            title="Editar"
                            data-bs-toggle="tooltip">
                      <i class="bi bi-pencil"></i>
                    </button>

                    <div class="dropdown d-inline-block">
                      <button class="btn btn-action btn-sm dropdown-toggle" type="button"
                              data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-three-dots-vertical"></i>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                          <button class="dropdown-item" (click)="toggleEstado(ot)">
                            <i class="bi me-2" [ngClass]="ot.activo ? 'bi-toggle-on' : 'bi-toggle-off'"></i>
                            {{ot.activo ? 'Desactivar' : 'Activar'}}
                          </button>
                        </li>

                      </ul>
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
        <div *ngIf="!loading && totalPages > 0" class="pagination-section">
          <div class="container-fluid">
            <app-pagination
              [currentPage]="currentPage"
              [totalItems]="totalElements"
              [totalPages]="totalPages"
              [pageSize]="pageSize"
              [showInfo]="true"
              [showSizeSelector]="true"
              [showNavigation]="true"
              [showJumpToPage]="true"
              [showPageNumbers]="true"
              [pageSizes]="[10, 20, 50, 100]"
              [align]="'center'"
              [size]="'md'"
              [isLoading]="loading"
              (pageChange)="goToPage($event)"
              (pageSizeChange)="changePageSize($event)"
              (refresh)="refreshTable()">
            </app-pagination>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- ==================== MODAL DE IMPORTACIÓN ==================== -->
<ng-template #importModal>
  <div class="modal-header border-0 pb-0">
    <div>
      <h5 class="modal-title fw-bold text-gray-800">
        <i class="bi bi-upload me-2 text-primary"></i>
        Importar Órdenes de Trabajo
      </h5>
      <p class="text-muted small mb-0">Sube un archivo Excel para importar múltiples OTs</p>
    </div>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalService.dismissAll()"></button>
  </div>

  <div class="modal-body py-4">
    <!-- Paso 1: Selección de archivo -->
    <div *ngIf="importStep === 1" class="text-center py-3">
      <div class="drop-zone rounded-3 border-2 border-dashed border-gray-300 p-5"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onFileDrop($event)"
           [class.drag-over]="false">
        <div class="py-4">
          <div class="upload-icon mb-3">
            <i class="bi bi-file-earmark-excel text-success fs-1"></i>
          </div>
          <h5 class="text-gray-700 fw-bold mb-2">Arrastra tu archivo aquí</h5>
          <p class="text-gray-600 mb-4">O haz clic para seleccionar</p>

          <div class="mb-3">
            <label class="btn btn-primary btn-lg cursor-pointer">
              <i class="bi bi-folder me-2"></i>
              Seleccionar archivo
              <input type="file"
                     class="d-none"
                     accept=".xlsx,.xls"
                     (change)="onFileSelected($event)">
            </label>
          </div>

          <div class="alert alert-info border-0 bg-light mt-4">
            <div class="d-flex align-items-start">
              <i class="bi bi-info-circle fs-5 me-3"></i>
              <div class="text-start">
                <h6 class="alert-heading mb-2 small">Formatos soportados</h6>
                <p class="mb-1 small">• Archivos Excel (.xlsx, .xls)</p>
                <p class="mb-1 small">• Tamaño máximo: 20MB</p>
                <p class="mb-0 small">• Descarga la plantilla para ver el formato requerido</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paso 2: Confirmación -->
    <div *ngIf="importStep === 2 && importFile" class="text-center py-3">
      <div class="file-preview bg-light rounded-3 p-4">
        <div class="file-icon mb-3">
          <i class="bi bi-file-earmark-excel text-success fs-1"></i>
        </div>

        <div class="file-info mb-4">
          <h6 class="text-gray-800 fw-bold mb-1">{{ importFile.name }}</h6>
          <p class="text-gray-600 small mb-0">
            <i class="bi bi-file-text me-1"></i>
            {{ formatFileSize(importFile.size) }} •
            <i class="bi bi-calendar ms-3 me-1"></i>
Última modificación: {{ importFile.lastModified | date:'dd/MM/yyyy HH:mm' }}
          </p>
        </div>

        <div class="mode-selection mb-4">
          <label class="form-label fw-medium text-gray-700 mb-2">Modo de importación:</label>
          <div class="d-flex gap-3 justify-content-center">
            <div class="form-check">
              <input class="form-check-input" type="radio" id="modeNormal"
                     [(ngModel)]="importMode" value="normal" checked>
              <label class="form-check-label fw-medium" for="modeNormal">
                <i class="bi bi-arrow-up-circle me-1"></i>
                Normal
              </label>
              <small class="d-block text-muted">Hasta 100 registros</small>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" id="modeMasivo"
                     [(ngModel)]="importMode" value="masivo">
              <label class="form-check-label fw-medium" for="modeMasivo">
                <i class="bi bi-lightning me-1"></i>
                Masivo
              </label>
              <small class="d-block text-muted">Más de 100 registros</small>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center gap-3 mt-4">
          <button type="button" class="btn btn-outline-gray"
                  (click)="importStep = 1; importFile = null">
            <i class="bi bi-arrow-left me-2"></i>
            Cambiar archivo
          </button>
          <button type="button" class="btn btn-success"
                  (click)="startImport()"
                  [disabled]="importing">
            <span *ngIf="!importing">
              <i class="bi bi-upload me-2"></i>
              Iniciar importación
            </span>
            <span *ngIf="importing">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Importando...
            </span>
          </button>
        </div>
      </div>
    </div>

    <!-- Paso 3: Resultados -->
    <div *ngIf="importStep === 3 && importResult" class="py-3">
      <div class="text-center mb-4">
        <div class="result-icon mb-3">
          <i *ngIf="importResult.exito" class="bi bi-check-circle-fill text-success fs-1"></i>
          <i *ngIf="!importResult.exito" class="bi bi-exclamation-triangle-fill text-warning fs-1"></i>
        </div>
        <h5 [class]="importResult.exito ? 'text-success' : 'text-warning'">
          {{ importResult.exito ? 'Importación exitosa' : 'Importación con advertencias' }}
        </h5>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-6">
          <div class="card border-success bg-success bg-opacity-10 h-100">
            <div class="card-body text-center py-3">
              <h2 class="text-success fw-bold">{{ importResult.exitosos || 0 }}</h2>
              <p class="text-success mb-0 small">Registros exitosos</p>
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="card border-warning bg-warning bg-opacity-10 h-100">
            <div class="card-body text-center py-3">
              <h2 class="text-warning fw-bold">{{ importResult.fallidos || 0 }}</h2>
              <p class="text-warning mb-0 small">Registros fallidos</p>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="importResult.fallidos > 0" class="alert alert-warning border-0">
        <div class="d-flex align-items-start">
          <i class="bi bi-exclamation-triangle me-3 fs-5"></i>
          <div class="flex-grow-1">
            <h6 class="alert-heading mb-2">Algunos registros no se importaron</h6>
            <p class="mb-0 small">Revisa los errores y corrige el archivo para reintentar.</p>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-4">
        <button type="button" class="btn btn-outline-gray"
                (click)="importStep = 1; importFile = null; importResult = null">
          <i class="bi bi-plus-circle me-2"></i>
          Nueva importación
        </button>

        <div class="d-flex gap-2">
          <button *ngIf="importResult.fallidos > 0" type="button"
                  class="btn btn-outline-primary"
                  (click)="downloadErrorReport()">
            <i class="bi bi-download me-2"></i>
            Descargar errores
          </button>
          <button type="button" class="btn btn-primary"
                  (click)="modalService.dismissAll(); refreshTable()">
            <i class="bi bi-check me-2"></i>
            Finalizar
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer border-0 pt-0">
    <div class="w-100 text-center">
      <button type="button" class="btn btn-link text-decoration-none text-gray-600"
              (click)="downloadImportTemplate()">
        <i class="bi bi-download me-2"></i>
        Descargar plantilla
      </button>
      <button type="button" class="btn btn-link text-decoration-none text-gray-600"
              (click)="showImportHelp()">
        <i class="bi bi-question-circle me-2"></i>
        Ayuda de formato
      </button>
    </div>
  </div>
</ng-template>

<!-- ==================== MODAL DE EXPORTACIÓN ==================== -->
<ng-template #exportModal>
  <div class="modal-header border-0 pb-0">
    <div>
      <h5 class="modal-title fw-bold text-gray-800">
        <i class="bi bi-download me-2 text-primary"></i>
        Exportar Órdenes de Trabajo
      </h5>
      <p class="text-muted small mb-0">Configura los filtros para exportar</p>
    </div>
    <button type="button" class="btn-close" aria-label="Close" (click)="modalService.dismissAll()"></button>
  </div>

  <div class="modal-body py-4">
    <div class="mb-4">
      <div class="form-check form-switch mb-3">
        <input class="form-check-input" type="checkbox" id="exportFiltroActivo"
               [(ngModel)]="exportFiltroActivo">
        <label class="form-check-label fw-medium text-gray-700" for="exportFiltroActivo">
          Exportar solo seleccionadas
          <span *ngIf="exportFiltroActivo" class="badge bg-primary ms-2">{{selectedCount}} OTs</span>
        </label>
      </div>

      <div *ngIf="!exportFiltroActivo" class="mb-3">
        <label class="form-label fw-medium text-gray-700 mb-2">Filtro de búsqueda:</label>
        <input type="text" class="form-control"
               [(ngModel)]="exportFiltroText"
               placeholder="Mismo filtro de la tabla...">
      </div>
    </div>

    <div class="alert alert-info border-0">
      <div class="d-flex align-items-start">
        <i class="bi bi-info-circle me-3 fs-5"></i>
        <div class="flex-grow-1">
          <h6 class="alert-heading mb-2 small">Información de exportación</h6>
          <p class="mb-0 small">
            Se generará un archivo Excel con todas las columnas visibles en la tabla.
            El proceso puede tardar varios segundos dependiendo de la cantidad de datos.
          </p>
        </div>
      </div>
    </div>
  </div>

  <div class="modal-footer border-0">
    <button type="button" class="btn btn-outline-gray"
            (click)="modalService.dismissAll()">
      Cancelar
    </button>
    <button type="button" class="btn btn-primary" (click)="export()">
      <i class="bi bi-download me-2"></i>
      Iniciar exportación
    </button>
  </div>
</ng-template>
