<div *ngIf="loading" class="text-center py-3">
  Cargando aprobaciones...
</div>

<div *ngIf="!loading && aprobaciones.length > 0" class="timeline-container">

  <div *ngFor="let aprob of aprobaciones"
       class="timeline-item mb-3 p-3 border rounded shadow-sm">

    <div class="d-flex align-items-center mb-2">
      <div class="timeline-dot"
           [ngStyle]="{
             'background-color': getColor(aprob.estado),
             'width.px': 14,
             'height.px': 14,
             'border-radius': '50%',
             'margin-right': '10px'
           }">
      </div>

      <strong>Nivel {{ aprob.nivel }}</strong>

      <span class="badge ms-2"
            [ngStyle]="{
              'background-color': getColor(aprob.estado),
              'color': '#fff'
            }">
        {{ aprob.estado }}
      </span>
    </div>

    <div class="ms-4">
      <p><b>Aprobado por:</b> {{ aprob.aprobadoPor || '-' }}</p>
      <p><b>Inicio:</b> {{ aprob.fechaInicio | date:'short' }}</p>
      <p *ngIf="aprob.fechaFin"><b>Fin:</b> {{ aprob.fechaFin | date:'short' }}</p>
      <p><b>Días en estado:</b> {{ aprob.diasEnEstado }}</p>

      <!-- BOTONES -->
      <div *ngIf="aprob.estado === 'PENDIENTE'" class="mt-3 d-flex gap-2">
        <button class="btn btn-sm btn-success"
                (click)="aprobarNivel(aprob)">
          ✔ Aprobar
        </button>

        <button class="btn btn-sm btn-outline-danger"
                (click)="rechazarNivel(aprob)">
          ✖ Rechazar
        </button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!loading && aprobaciones.length === 0"
     class="text-center py-3 text-muted">
  No hay aprobaciones registradas
</div>

<!-- ✅ BOTÓN FINAL -->
<div *ngIf="aprobacionFinalizada" class="mt-4">

  <label class="form-label fw-bold">Empresa</label>
  <select class="form-select mb-3"
          [(ngModel)]="idEmpresaSeleccionada">
    <option [value]="1">COMFUTURA</option>
    <option [value]="2">EMPRESA 2</option>
    <option [value]="3">EMPRESA 3</option>
  </select>

  <button class="btn btn-primary w-100"
          (click)="descargarHtml()">
    Descargar Orden de Compra (HTML)
  </button>

</div>


